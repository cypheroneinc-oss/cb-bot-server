// bot_server/lib/result-content.js
// 診断結果テキスト（完全版：12アーキタイプ対応）
// ポリシー：向いてない職業は出さない / 職業には活かし方の短いblurbを併記
// 互換性：既存のCLUSTER_* APIは温存（画面はHERO_CONTENTを使う）
// NOTE: アバターは heroes/<slug>.png を推奨（CDN未設定時はplacehold）

/* ================================
 * クラスタ（既存互換）
 * ================================ */
const CLUSTER_LABELS = {
  challenge: 'チャレンジ',
  creative: 'クリエイティブ',
  support: 'サポート',
  strategy: 'ストラテジー',
};

// 既存画面や他所参照の互換用。画面表示はHERO_CONTENTを使用する前提。
const CLUSTER_CONTENT = {
  challenge: {
    summary1line: '直感と行動で空気を切り開くフロントランナー。',
    strengths: ['初動が速い', '人前での牽引力', '未知にワクワクできる'],
    misfit_env: ['細かい手順の厳守だけを重視する現場', '自由度が極端に低い体制'],
    how_to_use: ['最初の火付け役を任せる', '0→1の検証タスクで先頭に置く', '議論の場で推進役を任命する'],
    next_action: ['今週、誰も手を出していない小タスクを自分発で提案→着手'],
  },
  creative: {
    summary1line: 'ひらめきと探究心で新しい景色を描くアイデアメーカー。',
    strengths: ['直感的な発想力', '試行錯誤を楽しむ粘り強さ', '感性で周囲を刺激する力'],
    misfit_env: ['正解が一つに決められた単調な仕事', '自由な試作が許されない環境'],
    how_to_use: ['ブレストや企画立ち上げの起爆剤にする', '試作品づくりや表現タスクを任せる', '学びのアウトプットを共有してもらう'],
    next_action: ['気になるアイデアを一つスケッチに起こしてチームに共有する'],
  },
  support: {
    summary1line: '共感と気配りで安心感をつくるチームの調律者。',
    strengths: ['相手の変化に気づく観察眼', '困りごとを拾う聞き役力', '裏側から支える段取り力'],
    misfit_env: ['競争だけを煽る評価制度', '個人プレーを強いるワンマン体制'],
    how_to_use: ['チームのハブ役やフォロー役を任せる', '新人や後輩のオンボーディングを任せる', '声を拾うファシリ役で活かす'],
    next_action: ['最近様子が気になるメンバーに声をかけ、短い対話時間をつくる'],
  },
  strategy: {
    summary1line: '俯瞰とロジックで道筋を描く現場の設計士。',
    strengths: ['物事を整理する構造化力', 'リスクを見抜く観察力', '安定運用を支える継続力'],
    misfit_env: ['計画を無視した場当たり的運営', '情報が曖昧なまま突き進むプロジェクト'],
    how_to_use: ['業務の標準化やルール整備を任せる', '判断材料を集めるリサーチ役にする', '中長期計画の進行管理を依頼する'],
    next_action: ['直近のタスクを棚卸しし、優先順位と手順を1枚にまとめて共有する'],
  },
};

/* ================================
 * ヒーロー基本情報（表示名・クラスタ・アバター）
 * ================================ */
// 12アーキタイプのスラッグ：hero / outlaw / explorer / creator / sage / magician / caregiver / ruler / everyman / jester / lover / innocent
const HERO_METADATA = {
  hero:      { name: '光の勇者（Hero）',                 cluster: 'challenge', avatar: 'hero.png' },
  outlaw:    { name: '影の反逆者（Outlaw）',             cluster: 'challenge', avatar: 'outlaw.png' },
  explorer:  { name: '星の探検者（Explorer）',           cluster: 'creative',  avatar: 'explorer.png' },
  creator:   { name: '夢紡ぎの創造者（Creator）',        cluster: 'creative',  avatar: 'creator.png' },
  sage:      { name: '叡智の賢者（Sage）',               cluster: 'strategy',  avatar: 'sage.png' },
  magician:  { name: '時を操る魔導師（Magician）',       cluster: 'strategy',  avatar: 'magician.png' },
  caregiver: { name: '慈愛の守護者（Caregiver）',        cluster: 'support',   avatar: 'caregiver.png' },
  ruler:     { name: '王冠の統治者（Ruler）',            cluster: 'strategy',  avatar: 'ruler.png' },
  everyman:  { name: '絆の共鳴者（Everyman）',           cluster: 'support',   avatar: 'everyman.png' },
  jester:    { name: '虹の道化師（Jester）',             cluster: 'creative',  avatar: 'jester.png' },
  lover:     { name: '愛結ぶ恋人（Lover）',              cluster: 'support',   avatar: 'lover.png' },
  innocent:  { name: '純真なる探求者（Innocent / Seeker）', cluster: 'support',   avatar: 'innocent.png' },
};

/* ================================
 * 画面表示用 本文データ（12タイプ）
 * - hero_copy / personality / scenes / tips / jobs.suited[{name, blurb}] / reactions
 * - 活躍シーン：必ず「中高生→社会人→中高生→社会人」の順
 * ================================ */
const HERO_CONTENT = {
  hero: {
    hero_copy:
      '困難な場で先頭に立ち、人を支えながら前へ進める推進力。プレッシャーを燃料に変え、チームを牽引する光のタイプ。',
    personality: {
      title: '責任と行動で場を動かすリーダー気質',
      paragraphs: [
        '人が困っていると自然に体が動く。頼られるほど力が増すタイプ。',
        '最も恐いのは、全力でも結果が出ず無力だと感じる瞬間。',
        '勢いが独りよがりに見られることがあるが、根には「誰かのため」の意図。',
        '具体的なゴール設定と途中確認で、情熱が信頼に変わる。',
      ],
    },
    scenes: [
      '文化祭や体育祭のトラブルで前に立ち、場をまとめる',
      '会議で議論が散らかったとき、方向を示して収束させる',
      '部活の勝負所で声を出し、仲間の背中を押す',
      '部署横断の調整役として優先順位を整理し推進する',
    ],
    tips: [
      '成果の“形”を先に決めて集中力を安定させる',
      '小刻みな目標で燃え尽きを防ぐ',
      '計画型の相棒と組み、独走を防ぐ',
      '途中レビューを定例化して合意形成を早める',
    ],
    jobs: {
      suited: [
        { name: 'プロジェクトマネージャー', blurb: '責任と推進でチームを導く。' },
        { name: 'スポーツ指導/部活動顧問', blurb: '鼓舞と育成で力を引き出す。' },
        { name: '営業リーダー', blurb: '目標と役割を示し成果に結ぶ。' },
        { name: 'イベント運営', blurb: '現場判断で人と流れを動かす。' },
      ],
    },
    reactions: [
      'Explorer × Hero → 「探検心 × 行動力」で挑戦が加速',
      'Caregiver × Hero → 「支え × 勇気」で安心と挑戦が両立',
    ],
  },

  outlaw: {
    hero_copy:
      '理不尽や形だけの常識に抗い、世界を更新する反骨の美学。壊すためでなく、より良く創り直すために問う人。',
    personality: {
      title: '枠を疑い、意味から作り直す改革者気質',
      paragraphs: [
        '「こうあるべき」に閉じ込められるのが苦手。自由の本能が強い。',
        '最も恐いのは、声が届かず変わらない現実に息苦しくなること。',
        '「反抗的」に見られがちだが、本音と誠実さを守っているだけ。',
        '衝動を理念に変えると言語化が進み、仲間が増える。',
      ],
    },
    scenes: [
      '学校で矛盾を感じたルールに「なぜ？」と問い直す',
      '形式的な会議で前提をひっくり返し再設計する',
      '文化祭で前例のない企画を通して実現する',
      '既存プロセスを捨て、より良い運用に刷新する',
    ],
    tips: [
      '「何を壊すか」だけでなく「何を創るか」を明確化',
      '一次情報と仲間の合意で摩擦を創造に変える',
      '対立構造ではなく選択肢の設計に集中',
      '小さく検証し勝ち筋を積む',
    ],
    jobs: {
      suited: [
        { name: '新規事業/事業開発', blurb: '前提を問い直し価値を再定義。' },
        { name: 'プロダクトマネージャー', blurb: '不要を捨てて本質に集中。' },
        { name: '政策/アドボカシー', blurb: '制度の歪みを是正し更新する。' },
        { name: 'クリエイティブディレクター', blurb: '常識外の企画で空気を変える。' },
      ],
    },
    reactions: [
      'Creator × Outlaw → 「創造 × 破壊」で革新が生まれる',
      'Sage × Outlaw → 「叡智 × 反骨」で冷静な改革',
    ],
  },

  explorer: {
    hero_copy:
      '未知に惹かれ、発見を糧に前へ進む自由な旅人。安定より可能性に反応し、景色を切り替えていく。',
    personality: {
      title: '「まだ見ぬ何か」を探す自由志向',
      paragraphs: [
        '同じ毎日より未知の道を歩きたい。発見が燃料になるタイプ。',
        '最も恐いのは、停滞し続ける感覚。変化がないと色が失われる。',
        '気分屋に見られるが、内側の成長を求めているだけ。',
        'ざっくりした方向性を持つと、探求が成果に繋がる。',
      ],
    },
    scenes: [
      '修学旅行の自由行動で人が行かないルートを選び発見する',
      '部署異動や転職で新領域に飛び込み早期に順応する',
      '放課後に新しいスポットやイベントを仲間と開拓する',
      '前例のない企画を自ら情報収集して実行する',
    ],
    tips: [
      '“行き先を決めすぎない地図”で方向だけ合わせる',
      '発見を共有化してモチベと信頼を維持',
      '刺激依存を避け、小さな振り返りを習慣化',
      '旅の相棒（構造化役）とチームを組む',
    ],
    jobs: {
      suited: [
        { name: 'リサーチャー/フィールドワーク', blurb: '現場で未知を発見し可視化。' },
        { name: '企画/編集', blurb: '新しい視点を編み直し発信。' },
        { name: '旅行/地域プロデュース', blurb: '地域の可能性を掘り起こす。' },
        { name: 'スタートアップ全般', blurb: '変化を楽しみながら価値探索。' },
      ],
    },
    reactions: [
      'Hero × Explorer → 「勇気 × 探究」で壁を突破',
      'Sage × Explorer → 「知性 × 自由」で深い発見',
    ],
  },

  creator: {
    hero_copy:
      'まだない形を生み出し、日常を特別に変える表現者。感性と観察で未来を具現化する。',
    personality: {
      title: '想像を形に落とす没入タイプ',
      paragraphs: [
        '細部の機微を掬い取り、作品や企画に落とし込む力。',
        '最も恐いのは、表現が誰にも届かず空気になること。',
        'こだわりが気まぐれに見えるが、内に“完成形”があるだけ。',
        '途中共有と制約受容で、感性が影響力に変わる。',
      ],
    },
    scenes: [
      '美術・文化祭のビジュアルを中核アイデアでまとめる',
      '新規事業プレゼンで唯一無二の構成とビジュアルを作る',
      '自由研究や動画制作で細部まで作り込み完成させる',
      'チーム開発で「言葉にならない想い」を形にして共感を生む',
    ],
    tips: [
      '完璧主義ではなく途中共有で伴走者を増やす',
      '制約（納期/予算）を創造のフレームにする',
      '他者の感性を取り入れて奥行きを出す',
      '作品の“出口（誰に届くか）”を設計する',
    ],
    jobs: {
      suited: [
        { name: 'デザイン/アート/映像', blurb: '感性を価値へ翻訳。' },
        { name: 'コンテンツ企画/編集', blurb: '物語設計で心を動かす。' },
        { name: 'サービスデザイン', blurb: '体験全体を組み立てる。' },
        { name: 'プロトタイピング', blurb: '発想を早く可視化する。' },
      ],
    },
    reactions: [
      'Outlaw × Creator → 「破壊 × 創造」で常識を超える',
      'Magician × Creator → 「変容 × 具現化」で理想を現実に',
    ],
  },

  sage: {
    hero_copy:
      '混乱を整理し、真実を見極める静かな知性。感情に流されず、理解で人を導く。',
    personality: {
      title: '「なぜ？」を手放さない論理派',
      paragraphs: [
        '仕組みと根拠を確かめ、正確さと本質を大切にする。',
        '最も恐いのは、曖昧なまま決めつけて進む世界。',
        '感情が薄いと誤解されがちだが、言葉を慎重に選んでいるだけ。',
        '理解の先に“伝える力”を持つと、知恵が生きた力になる。',
      ],
    },
    scenes: [
      '授業で「なぜ？」を問い全員が分かる説明を引き出す',
      '感情論に傾いた会議で論点を整理して方向を定める',
      '文化祭準備の複雑工程を仕組み化してスムーズに進める',
      'データ分析で意思決定の根拠を提示する',
    ],
    tips: [
      '知識の共有と可視化で孤立を防ぐ',
      '守りたい価値（感情の源）も明確にする',
      '完璧主義を緩め「進みながら考える」を採用',
      '比喩と図解で理解コストを下げる',
    ],
    jobs: {
      suited: [
        { name: '研究/アナリティクス', blurb: '仮説と実証で価値を示す。' },
        { name: '教育/研修', blurb: '難解を翻訳し人を導く。' },
        { name: '業務設計/品質管理', blurb: '仕組みで安定を作る。' },
        { name: 'テクニカルライター', blurb: '知を言葉にして広げる。' },
      ],
    },
    reactions: [
      'Explorer × Sage → 「探求 × 知性」で未知を深く理解',
      'Magician × Sage → 「直感 × 理論」で現実を変える知恵',
    ],
  },

  magician: {
    hero_copy:
      '変化の流れを読み、見えない糸を結び直して状況を好転させる調整と変容の達人。',
    personality: {
      title: '直感と俯瞰で「流れ」を変えるタイプ',
      paragraphs: [
        '未来の筋道を描き、タイミングよく動いて全体を滑らかにする。',
        '最も恐いのは、周囲とテンポが合わず直感が信じてもらえないこと。',
        '掴みどころがないと言われがちだが、全体のつながりを感じ取っている。',
        '直感の言語化で理解者が増え、魔法は現実を動かす力に変わる。',
      ],
    },
    scenes: [
      '重くなった部活の空気を一言でほぐす',
      '行き詰まりの会議に全く別の視点を投げ再起動させる',
      '文化祭のトラブル兆候を早期に察知し流れを立て直す',
      'プロジェクトの役割を再配置して加速度を生む',
    ],
    tips: [
      '感じた理由を短く言語化する習慣',
      '兆しのメモで未来予測の精度を上げる',
      '「何を変えたいか」を可視化して合意形成',
      '構造派の相棒と設計→実行の循環を作る',
    ],
    jobs: {
      suited: [
        { name: 'プロデューサー/PM', blurb: '人と流れを編んで成果へ。' },
        { name: '戦略/事業再生', blurb: '再配置と変容で事業を動かす。' },
        { name: 'クリエイティブ演出', blurb: '場の空気をデザインする。' },
        { name: 'カウンセリング/コーチ', blurb: '変化の兆しを言葉にする。' },
      ],
    },
    reactions: [
      'Creator × Magician → 「創造 × 変容」で理想が具現化',
      'Sage × Magician → 「叡智 × 直感」で流れを設計',
    ],
  },

  caregiver: {
    hero_copy:
      '痛みに寄り添い、安心を生む支えの力。優しさは弱さではなく、誰かを守る確かな強さ。',
    personality: {
      title: '人のために自然と動ける伴走者気質',
      paragraphs: [
        '困っている人を放っておけず、行動で寄り添える。',
        '最も恐いのは、献身が軽く扱われ我慢だけが積もること。',
        'お人好しに見られがちだが、実は場をよく見てバランスを取っている。',
        '自己犠牲にしない境界線で、優しさは長く続く力に変わる。',
      ],
    },
    scenes: [
      'クラスの意見対立で双方の気持ちを整理し橋渡しする',
      '新人や後輩の落ち込みを静かにフォローし立て直す',
      '孤立した友達が輪に戻れるよう空気を整える',
      'ミスが起きた現場で責めずに支援体制を再構築する',
    ],
    tips: [
      '「助けてもらう」経験も大切にして自己回復力を持つ',
      '断る勇気＝優しさを長く続ける前提',
      '仕組み化で支援の面積を広げる',
      '定期的なセルフチェック「今の私は大丈夫？」',
    ],
    jobs: {
      suited: [
        { name: '教育/保育', blurb: '成長を見守り安心を育む。' },
        { name: '医療/看護/介護', blurb: '寄り添いと実務で支える。' },
        { name: '人事/オンボーディング', blurb: '働きやすさを整える。' },
        { name: 'カスタマーサクセス', blurb: '課題に伴走し関係を育てる。' },
      ],
    },
    reactions: [
      'Hero × Caregiver → 「勇気 × 支え」で挑戦に安心',
      'Lover × Caregiver → 「愛情 × 共感」で信頼が深まる',
    ],
  },

  ruler: {
    hero_copy:
      '混乱を整え、秩序を作る設計者。支配ではなく、皆が動ける環境をつくる使命感で舵を取る。',
    personality: {
      title: '全体最適で前に進める統治タイプ',
      paragraphs: [
        'バラバラをまとめ、優先順位を決めて進めるのが得意。',
        '最も恐いのは、信頼していた体制が崩れ統率が取れなくなること。',
        '完璧主義に見られがちだが、誰かが困る状況を避けたいだけ。',
        '「任せる勇気」でチームの可能性が拡張する。',
      ],
    },
    scenes: [
      '学級委員や部長として行事進行を整えチームをまとめる',
      '部門横断のリーダーとして現場の意見を集約し方針化',
      'グループ課題の意見を整理し現実的な計画に落とす',
      'トラブル時に冷静な優先順位付けで全体を立て直す',
    ],
    tips: [
      '責任を抱え込まず委任設計を行う',
      '“整える”に意識を置き支配化を避ける',
      '長期視点と短期KPIを両立',
      '信頼の可視化（約束・進捗・役割）で摩擦低減',
    ],
    jobs: {
      suited: [
        { name: '組織マネジメント', blurb: '人と仕組みを整え成果へ。' },
        { name: '事業/オペレーション設計', blurb: '安定運用の土台を作る。' },
        { name: 'スクラムマスター', blurb: '自律分散を支える統治。' },
        { name: '行政/教育運営', blurb: '公共性と秩序で安心を作る。' },
      ],
    },
    reactions: [
      'Sage × Ruler → 「叡智 × 統率」で安定した判断',
      'Caregiver × Ruler → 「支え × 管理」で人を守る運営',
    ],
  },

  everyman: {
    hero_copy:
      '特別でなくても「一緒にいたい」関係をつくる共感の核。場の温度を感じ、安心の空気を保つ。',
    personality: {
      title: '誰も取りこぼさない調和タイプ',
      paragraphs: [
        '人の間の温度を敏感に感じ、居心地のよい環境を大切にする。',
        '最も恐いのは、仲間外れや「必要とされていない」感覚。',
        '控えめに見られるが、否定せず空気を守っている。',
        '自分を大切にするほど、周囲もあなたを大切にする。',
      ],
    },
    scenes: [
      'クラスで意見がぶつかったとき自然に間を取り持つ',
      '会議で立場の違う意見をまとめ共通点を見つける',
      '休み時間に孤立した友達を輪に戻す',
      '緊張した職場の空気をさりげない一言で変える',
    ],
    tips: [
      '「自分の居場所を守る強さ」を育てる',
      '本音を短く伝える練習',
      '定期的なひとり時間で回復を設計',
      '調整役に評価指標を置き可視化する',
    ],
    jobs: {
      suited: [
        { name: 'カスタマーサポート', blurb: '安心の窓口をつくる。' },
        { name: '人事/総務', blurb: '社内の呼吸を整える。' },
        { name: 'コミュニティ運営', blurb: '居場所を設計し維持する。' },
        { name: '接客/販売', blurb: '関係性で体験価値を高める。' },
      ],
    },
    reactions: [
      'Caregiver × Everyman → 「支え × 共感」で誰も取りこぼさない',
      'Jester × Everyman → 「笑い × 絆」で安心と楽しさが広がる',
    ],
  },

  jester: {
    hero_copy:
      '重い空気を一瞬でほぐし、希望を取り戻すムードメーカー。笑いは軽さではなく、人をつなぐ知恵。',
    personality: {
      title: '楽しさで人を前向きにする潤滑タイプ',
      paragraphs: [
        '雰囲気が沈むほど明るさで場を整えられる。',
        '最も恐いのは、楽しさが奪われ自由に発言できないこと。',
        '軽く見られがちだが、裏には思いやりと観察力。',
        '笑いの意図を自覚すると、信頼と影響力が増す。',
      ],
    },
    scenes: [
      '文化祭や部活で沈んだ空気をユーモアで一変させる',
      '重たい会議に軽い一言を差し込み発言しやすくする',
      '落ち込む友達を冗談で切り替えさせる',
      '行き詰まるチームに遊び心の視点で突破口を作る',
    ],
    tips: [
      'なぜ空気を変えたいのか意図を持つ',
      '時に真面目な話をする勇気を持つ',
      '価値に気づく仲間と組み長く続ける',
      'ユーモアと事実のバランスを取る',
    ],
    jobs: {
      suited: [
        { name: 'イベント/広報', blurb: '感情を動かし関係を温める。' },
        { name: '接客/サービス', blurb: '場作りで体験価値を上げる。' },
        { name: 'クリエイティブ制作', blurb: '遊び心で発想を解放。' },
        { name: '社内エバンジェリスト', blurb: '推進と空気づくりを両立。' },
      ],
    },
    reactions: [
      'Everyman × Jester → 「共感 × 笑い」で緊張がほぐれる',
      'Explorer × Jester → 「探求 × 遊び心」で新発想が実行に',
    ],
  },

  lover: {
    hero_copy:
      'つながりの深さを信じ、心と心を結び直す力。恋愛に限らず、信頼と成長を育てる関係の達人。',
    personality: {
      title: '人の良さを引き出す関係構築タイプ',
      paragraphs: [
        '言葉にならない感情を察し、丁寧に関わることができる。',
        '最も恐いのは、真剣な気持ちを軽く扱われること。',
        '感情的に見られがちだが、深く関わる勇気があるだけ。',
        '「自分も大事にする愛」で関係は長く健やかに続く。',
      ],
    },
    scenes: [
      '友達の悩みに寄り添い共感と一言で肩を軽くする',
      'ぎくしゃくした職場で感情の橋渡し役を担う',
      '恋愛や友情で相手の良さを引き出し高め合う',
      '取引先との信頼関係を時間をかけて築く',
    ],
    tips: [
      '境界線を設け「依存」ではなく「成長の関係」に',
      '感情を言語化して共有',
      '期待と約束を整合して信頼を積む',
      '自分のケアをルーティン化',
    ],
    jobs: {
      suited: [
        { name: '営業/アカウントマネジメント', blurb: '信頼で成果を積み上げる。' },
        { name: '教育/キャリア支援', blurb: '伴走と励ましで伸ばす。' },
        { name: '広報/PR', blurb: '好意と物語で関係を結ぶ。' },
        { name: '人材紹介/CS', blurb: '相手の良さを引き出しマッチ。' },
      ],
    },
    reactions: [
      'Caregiver × Lover → 「支え × 愛」で温かな信頼',
      'Creator × Lover → 「表現 × 感情」で心を動かす体験',
    ],
  },

  innocent: {
    hero_copy:
      '「きっと良くなる」を最後まで信じられる希望の灯。純粋さは幼さではなく、理想を手放さない勇気。',
    personality: {
      title: '希望で空気を変えるポジティブ核',
      paragraphs: [
        'どんな状況でも小さな希望を見つけ前向きにできる。',
        '最も恐いのは、信じたものに裏切られ心が曇ること。',
        '楽天的に見られるが、悲しみを知った上で笑っている強さ。',
        '信じる対象を選ぶと、やさしさは現実的な力に変わる。',
      ],
    },
    scenes: [
      '落ち込む友達に「大丈夫、なんとかなるよ」と声をかける',
      '厳しい状況でも「まだできることがある」とチームを励ます',
      '失敗しても「次は絶対うまくいく」と切り替える',
      '新しい環境の不安を和らげ明るい雰囲気を作る',
    ],
    tips: [
      '全員を救おうとしない選択の勇気',
      '小さな前進を可視化して希望を維持',
      '理想と日常の行動をつなぐルーティン',
      '自分の心が曇るサインを記録',
    ],
    jobs: {
      suited: [
        { name: '教育/スクール運営', blurb: '前向きなビジョンで支える。' },
        { name: '広報/コミュニティ', blurb: '希望の物語を広げる。' },
        { name: '福祉/支援', blurb: '安心と継続で伴走。' },
        { name: 'スタートアップ一般', blurb: '信じる力で越境する。' },
      ],
    },
    reactions: [
      'Hero × Innocent → 「勇気 × 純粋」でまっすぐ人を動かす',
      'Explorer × Innocent → 「探求 × 希望」で困難が旅に変わる',
    ],
  },
};

/* ================================
 * ユーティリティ／エクスポート
 * ================================ */
function trimTrailingSlash(value) {
  return value ? value.replace(/\/$/, '') : '';
}

function buildAvatarUrl(slug, avatar) {
  if (!slug) return null;
  const explicit = avatar ?? '';
  if (explicit.startsWith('http://') || explicit.startsWith('https://')) {
    return explicit;
  }
  const base = trimTrailingSlash(
    process.env.HERO_CDN_BASE_URL ?? process.env.CDN_BASE_URL ?? ''
  );
  if (base) {
    const path = explicit ? explicit.replace(/^\//, '') : `${slug}.png`;
    return `${base}/heroes/${path}`;
  }
  const label = encodeURIComponent(slug);
  return `https://placehold.co/512x512?text=${label}`;
}

export function getClusterLabel(cluster) {
  return CLUSTER_LABELS[cluster] ?? cluster ?? '';
}

// 既存：基本プロフィール（名前・クラスタ・アバターURL）
export function getHeroProfile(slug) {
  const meta = HERO_METADATA[slug] ?? {
    name: `${slug ?? '不明'}タイプ`,
    cluster: 'challenge',
    avatar: `${slug ?? 'unknown'}.png`,
  };
  return {
    slug,
    name: meta.name,
    cluster: meta.cluster,
    avatarUrl: buildAvatarUrl(slug, meta.avatar),
  };
}

// 新規：ヒーロー本文（画面表示はこっちを使う）
export function getHeroNarrative(slug) {
  const data = HERO_CONTENT[slug];
  if (!data) {
    return {
      hero_copy: '',
      personality: { title: '', paragraphs: [] },
      scenes: [],
      tips: [],
      jobs: { suited: [] },
      reactions: [],
    };
  }
  return data;
}

// 既存互換：クラスター本文（旧UIが参照しても落ちない）
export function getClusterNarrative(cluster) {
  return CLUSTER_CONTENT[cluster] ?? {
    summary1line: '',
    strengths: [],
    misfit_env: [],
    how_to_use: [],
    next_action: [],
  };
}

export default {
  getClusterLabel,
  getClusterNarrative,
  getHeroProfile,
  getHeroNarrative,
};

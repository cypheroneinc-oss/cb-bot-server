<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>C by me｜かんたん診断</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <style>
    body { font-family: "Noto Sans JP", sans-serif; padding: 20px; }
    .question { margin-bottom: 20px; }
    .result { margin-top: 30px; font-weight: bold; font-size: 18px; }
    button { margin-top: 10px; padding: 8px 12px; }
  </style>
</head>
<body>
  <h2>📝 自分に合った働き方を診断！</h2>
  <form id="quizForm"></form>
  <button type="button" onclick="submitAnswers()">診断する</button>
  <div id="result" class="result"></div>

  <script>
    const questions = [
      { q: "仕事の進め方は？", a: ["とりあえず始めて直す", "整理してから始める"] },
      { q: "判断の決め手は？", a: ["直感・フィーリング", "データや理由"] },
      { q: "やる気が出る理由は？", a: ["成果達成", "承認", "貢献", "安心", "探究", "自由", "仲間", "成長"], multi: true },
      { q: "苦手な環境は？", a: ["細かく指示される", "丸投げされる"] },
      { q: "感情の出し方は？", a: ["すぐ顔や言葉に出る", "外には出さないけど心で燃える"] },
      { q: "安心できるチームは？", a: ["何でもハッキリ言える", "空気を大事に和やか"] },
      { q: "チームでの役割は？", a: ["リーダー", "サポート"] },
      { q: "働き方の理想は？", a: ["一つを極める", "色々挑戦する"] }
    ];

    // 質問をレンダリング
    const form = document.getElementById("quizForm");
    questions.forEach((q, i) => {
      const div = document.createElement("div");
      div.className = "question";
      div.innerHTML = `<p>${i+1}. ${q.q}</p>`;
      q.a.forEach(opt => {
        if (q.multi) {
          div.innerHTML += `<label><input type="checkbox" name="q${i}" value="${opt}"> ${opt}</label><br>`;
        } else {
          div.innerHTML += `<label><input type="radio" name="q${i}" value="${opt}"> ${opt}</label><br>`;
        }
      });
      form.appendChild(div);
    });

    async function submitAnswers() {
      const answers = [];
      questions.forEach((q, i) => {
        if (q.multi) {
          const selected = [...document.querySelectorAll(`input[name=q${i}]:checked`)].map(el => el.value);
          answers.push(selected);
        } else {
          const selected = document.querySelector(`input[name=q${i}]:checked`);
          answers.push(selected ? selected.value : null);
        }
      });

      // LIFFからユーザー情報取得
      await liff.init({ liffId: "<YOUR_LIFF_ID>" });
      const profile = await liff.getProfile();

      // サーバに送信
      const res = await fetch("/api/answer", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ userId: profile.userId, answers })
      });
      const data = await res.json();

      // 結果をユーザーに表示
      document.getElementById("result").innerText = `✨ あなたのタイプ：${data.type}\n${data.message}`;
    }
  </script>
</body>
</html>

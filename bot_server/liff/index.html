<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>C by meï½œã‹ã‚“ãŸã‚“è¨ºæ–­</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <style>
    body { font-family: "Noto Sans JP", sans-serif; padding: 20px; }
    .question { margin-bottom: 20px; }
    .result { margin-top: 30px; font-weight: bold; font-size: 18px; }
    button { margin-top: 10px; padding: 8px 12px; }
  </style>
</head>
<body>
  <h2>ğŸ“ è‡ªåˆ†ã«åˆã£ãŸåƒãæ–¹ã‚’è¨ºæ–­ï¼</h2>
  <form id="quizForm"></form>
  <button type="button" onclick="submitAnswers()">è¨ºæ–­ã™ã‚‹</button>
  <div id="result" class="result"></div>

  <script>
    const questions = [
      { q: "ä»•äº‹ã®é€²ã‚æ–¹ã¯ï¼Ÿ", a: ["ã¨ã‚Šã‚ãˆãšå§‹ã‚ã¦ç›´ã™", "æ•´ç†ã—ã¦ã‹ã‚‰å§‹ã‚ã‚‹"] },
      { q: "åˆ¤æ–­ã®æ±ºã‚æ‰‹ã¯ï¼Ÿ", a: ["ç›´æ„Ÿãƒ»ãƒ•ã‚£ãƒ¼ãƒªãƒ³ã‚°", "ãƒ‡ãƒ¼ã‚¿ã‚„ç†ç”±"] },
      { q: "ã‚„ã‚‹æ°—ãŒå‡ºã‚‹ç†ç”±ã¯ï¼Ÿ", a: ["æˆæœé”æˆ", "æ‰¿èª", "è²¢çŒ®", "å®‰å¿ƒ", "æ¢ç©¶", "è‡ªç”±", "ä»²é–“", "æˆé•·"], multi: true },
      { q: "è‹¦æ‰‹ãªç’°å¢ƒã¯ï¼Ÿ", a: ["ç´°ã‹ãæŒ‡ç¤ºã•ã‚Œã‚‹", "ä¸¸æŠ•ã’ã•ã‚Œã‚‹"] },
      { q: "æ„Ÿæƒ…ã®å‡ºã—æ–¹ã¯ï¼Ÿ", a: ["ã™ãé¡”ã‚„è¨€è‘‰ã«å‡ºã‚‹", "å¤–ã«ã¯å‡ºã•ãªã„ã‘ã©å¿ƒã§ç‡ƒãˆã‚‹"] },
      { q: "å®‰å¿ƒã§ãã‚‹ãƒãƒ¼ãƒ ã¯ï¼Ÿ", a: ["ä½•ã§ã‚‚ãƒãƒƒã‚­ãƒªè¨€ãˆã‚‹", "ç©ºæ°—ã‚’å¤§äº‹ã«å’Œã‚„ã‹"] },
      { q: "ãƒãƒ¼ãƒ ã§ã®å½¹å‰²ã¯ï¼Ÿ", a: ["ãƒªãƒ¼ãƒ€ãƒ¼", "ã‚µãƒãƒ¼ãƒˆ"] },
      { q: "åƒãæ–¹ã®ç†æƒ³ã¯ï¼Ÿ", a: ["ä¸€ã¤ã‚’æ¥µã‚ã‚‹", "è‰²ã€…æŒ‘æˆ¦ã™ã‚‹"] }
    ];

    // è³ªå•ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
    const form = document.getElementById("quizForm");
    questions.forEach((q, i) => {
      const div = document.createElement("div");
      div.className = "question";
      div.innerHTML = `<p>${i+1}. ${q.q}</p>`;
      q.a.forEach(opt => {
        if (q.multi) {
          div.innerHTML += `<label><input type="checkbox" name="q${i}" value="${opt}"> ${opt}</label><br>`;
        } else {
          div.innerHTML += `<label><input type="radio" name="q${i}" value="${opt}"> ${opt}</label><br>`;
        }
      });
      form.appendChild(div);
    });

    async function submitAnswers() {
      const answers = [];
      questions.forEach((q, i) => {
        if (q.multi) {
          const selected = [...document.querySelectorAll(`input[name=q${i}]:checked`)].map(el => el.value);
          answers.push(selected);
        } else {
          const selected = document.querySelector(`input[name=q${i}]:checked`);
          answers.push(selected ? selected.value : null);
        }
      });

      // LIFFã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±å–å¾—
      await liff.init({ liffId: "<YOUR_LIFF_ID>" });
      const profile = await liff.getProfile();

      // ã‚µãƒ¼ãƒã«é€ä¿¡
      const res = await fetch("/api/answer", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ userId: profile.userId, answers })
      });
      const data = await res.json();

      // çµæœã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«è¡¨ç¤º
      document.getElementById("result").innerText = `âœ¨ ã‚ãªãŸã®ã‚¿ã‚¤ãƒ—ï¼š${data.type}\n${data.message}`;
    }
  </script>
</body>
</html>
